# fetch の相対パスと絶対 URL の違い（Next.js/Node.js）

## 📅 学習日時

2025 年 8 月 11 日

## ✅ 結論

- クライアントサイド（React/ブラウザ）では `fetch('/api/xxx')` のような相対パスが利用可能。
- サーバーサイド（API Route/Node.js）では `fetch('http://localhost:3000/api/xxx')` のような絶対 URL が必要。
- Node.js の fetch は相対パスを解釈できず、TypeError になる。

## 🧠 詳細

### 背景

Next.js では API 通信に `fetch` を多用するが、実行環境によってパス指定の挙動が異なる。

### クライアントサイド（React/ブラウザ）

- ブラウザは現在のホスト（例: http://localhost:3000）を自動補完してくれる。
- 例: `fetch('/api/achievement?month=2025-08')` → `http://localhost:3000/api/achievement?month=2025-08` にアクセス。
- ページ・コンポーネント・hooks 内で使う場合は相対パスで OK。

### サーバーサイド（API Route/Node.js）

- Node.js の fetch は相対パスを解釈できない。
- 例: `fetch('/api/favorite-channels')` → TypeError: Failed to parse URL from /api/favorite-channels
- 必ず絶対 URL（例: `http://localhost:3000/api/favorite-channels`）を指定する必要がある。
- 本番環境では環境変数（BASE_URL など）でベース URL を管理するのがベストプラクティス。

### 実装例

```typescript
// クライアントサイド
fetch("/api/achievement?month=2025-08"); // OK

// サーバーサイド
const baseUrl = process.env.BASE_URL || "http://localhost:3000";
fetch(`${baseUrl}/api/favorite-channels`); // OK
```

### 参考

- [Next.js 公式ドキュメント](https://nextjs.org/docs/app/building-your-application/data-fetching/fetching)
- [Node.js fetch API](https://nodejs.org/api/globals.html#fetch)
