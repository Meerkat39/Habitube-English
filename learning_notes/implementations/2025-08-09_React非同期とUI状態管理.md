# Reactの非同期処理とUI状態管理のポイント

## 📅 学習日時
2025 年 8 月 9 日

## ✅ 結論
非同期関数（APIリクエスト等）を扱う場合、「操作の瞬間」と「完了の瞬間」でUI状態が分かれるため、useStateやuseEffectで明確に管理する必要がある。特にローディング・エラー・データの状態を分離し、連打防止やUI更新タイミングに注意することで、管理しやすくなる。

## 🧠 詳細
- ReactではAPIリクエスト等の非同期処理をuseEffectで管理することが多い。
- ボタン押下などのユーザー操作と、API完了（成功/失敗）は非同期でタイミングがズレる。
- そのため、
  - loading（リクエスト中）
  - error（失敗時）
  - data（取得結果）
 などの状態をuseStateで分けて管理する。
- 連打や多重リクエスト時は、loading状態でボタンを無効化するなどの工夫が有効。
- UI更新は「API完了後」に限定することで、表示のズレや不整合を防げる。
- useEffectの依存配列を適切に設計し、必要なタイミングでのみ再取得・再描画する。

### 参考コード（useAchievementList）
```typescript
export function useAchievementList(month: string) {
  const [data, setData] = useState<AchievementListResponse | null>(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    setLoading(true);
    setError(null);
    fetchAchievementList(month)
      .then(setData)
      .catch((e) => setError(e.message))
      .finally(() => setLoading(false));
  }, [month]);

  return { data, loading, error };
}
```

---
このように、非同期処理の開始・完了を明確に分離し、UI状態を管理することで、複雑な挙動もシンプルに制御できる。
